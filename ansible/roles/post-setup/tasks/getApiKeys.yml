- block:        
  - name: Get Sonarr API key
    shell: xmllint  --xpath '//Config/ApiKey' {{config_base_path}}/{{config_dir}}/sonarr/config.xml | sed '/^\/ >/d' | sed 's/<[^>]*.//g'
    register: sonarr_xmllint

  - name: Get Radarr API key
    shell: xmllint  --xpath '//Config/ApiKey' {{config_base_path}}/{{config_dir}}/radarr/config.xml | sed '/^\/ >/d' | sed 's/<[^>]*.//g'
    register: radarr_xmllint

  - name: Get Hydra API key
    shell: cat {{config_base_path}}/{{config_dir}}/nzbhydra2/nzbhydra.yml | grep apiKey | tr -d '"' | tr -d '[:space:]' | sed 's#apiKey:##g'
    register: hydra_key

  - name: Get Jackett API key
    shell: cat {{config_base_path}}/{{config_dir}}/jackett/Jackett/ServerConfig.json | grep APIKey | tr -d '"' | tr -d '[:space:]' | tr -d ',' | sed 's#APIKey:##g'
    register: jackett_key      
    
  - set_fact:
      sonarr_api_key: '{{sonarr_xmllint.stdout}}'
      radarr_api_key: '{{radarr_xmllint.stdout}}'
      hydra_api_key: '{{hydra_key.stdout}}'
      jackett_api_key: '{{jackett_key.stdout}}' 
      ip_address: "{{hostvars[inventory_hostname]['ansible_default_ipv4']['address']}}"

  - name: ip_address
    ansible.builtin.debug:
      var: ip_address

  tags: 
    - never
    - install              